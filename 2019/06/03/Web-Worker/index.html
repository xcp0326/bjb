<!Doctype html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <title>Web Worker | FE ç¬”è®°æœ¬ ğŸš€</title>
  
    <link rel="icon" href="/images/favico.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/bjb/style/gitalk.css">
  <link rel="stylesheet" href="/bjb/style/style.css">
  <script src="/bjb/js/gitalk.min.js"></script>
</head>
  <body>
    <header class="header">
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/bjb/" class="menu-item-link">é¦–é¡µ</a>
        </li>
      
        <li class="menu-item">
          <a href="/bjb/archives" class="menu-item-link">å½’æ¡£</a>
        </li>
      
    </ul>
  </nav>
  <h1 class="pc">FE ç¬”è®°æœ¬ ğŸš€</h1>
  <h1 class="mobile"><a href="/">FE ç¬”è®°æœ¬ ğŸš€</a></h1>
  <em>ã€Œ å­¦æµ·æ— æ¶¯ï¼Œæ²¡ç©ºæ’©å¦¹ï¼ã€</em>
</header>
    <main class="main">
      <article class="post">
  <div class="post-title">
    <h2 class="title">Web Worker</h2>
  </div>
  <div class="post-meta">
    <span class="post-time">2019-06-03 16:33:00</span>
    <span class="post-tags">
      
    </span>
    
  </div>
  <div class="post-content">
    <p>Web Worker å¯ä»¥åœ¨ä¸»çº¿ç¨‹åˆ›å»º Worker çº¿ç¨‹ï¼Œåœ¨ä¸»çº¿ç¨‹è¿è¡Œçš„åŒæ—¶ï¼ŒWorker çº¿ç¨‹åœ¨åå°åŒæ—¶è¿è¡Œã€‚Worker çº¿ç¨‹å®Œæˆä»»åŠ¡åï¼Œå¯ä»¥æŠŠç»“æœè¿”å›ç»™ä¸»çº¿ç¨‹ã€‚åœºæ™¯æ˜¯å¯ä»¥æŠŠä¸€äº›è®¡ç®—å¯†é›†å‹æˆ–é«˜å»¶è¿Ÿçš„ä»»åŠ¡æ”¾åœ¨ Worker çº¿ç¨‹ã€‚è€Œä¸»çº¿ç¨‹å°±è´Ÿè´£ UI äº¤äº’å•¥çš„ã€‚</p>
<p>Worker çº¿ç¨‹ä¸€æ—¦æ–°å»ºæˆåŠŸï¼Œå°±ä¼šå§‹ç»ˆè¿è¡Œã€‚</p>
<p>ä¸è¿‡ï¼ŒWorker æ˜¯æœ‰åŒæºé™åˆ¶çš„ï¼Œä¸èƒ½è®¿é—® DOMï¼ŒWorker çš„å…¨å±€å¯¹è±¡æ˜¯ WorkerGlobalScopeï¼Œæ‰€æœ‰å®ƒæ— æ³•è®¿é—®åˆ° window ä¸‹çš„å¤§éƒ¨åˆ†å¯¹è±¡ã€‚Worker ä¸‹æœ‰å®šä¹‰äº† Navigator å’Œ Location å¯¹è±¡ï¼Œä¸èƒ½ alertã€confirmï¼Œæœ‰ XMLHttpRequest å¯¹è±¡ã€‚Worker çº¿ç¨‹æ˜¯ä¸ä¸»çº¿ç¨‹ä¸åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒæ—¶ï¼Œä»–ä»¬æ˜¯ä¸èƒ½ç›´æ¥é€šä¿¡çš„ï¼Œå¿…é¡»é€šè¿‡æ¶ˆæ¯å®Œæˆï¼ˆpostMessageï¼‰ã€‚Worker çº¿ç¨‹æ˜¯æ— æ³•è¯»å–æœ¬åœ°æ–‡ä»¶çš„ã€‚</p>
<p>postMessage å‘é€æ¶ˆæ¯ï¼ŒonMessage ç›‘å¬å‘é€æ¥çš„æ¶ˆæ¯ã€‚</p>
<p>Worker å†…éƒ¨åŠ è½½å…¶ä»–è„šæœ¬ï¼ŒimportScripts()</p>
<p>ä¸»çº¿ç¨‹æŠŠäºŒè¿›åˆ¶æ•°æ®ç›´æ¥è½¬ç§»ç»™ Worker å­çº¿ç¨‹ï¼Œä¸€æ—¦è½¬ç§»ï¼Œä¸»çº¿ç¨‹å°†æ— æ³•å†ä½¿ç”¨ä¹‹å‰çš„äºŒè¿›åˆ¶æ•°æ®äº†ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹æ•°æ®çš„é—®é¢˜ã€‚è¿™ç§è½¬ç§»æ•°æ®çš„æ–¹æ³•è„š Transferable Objectsã€‚</p>
<p>Worker è½½å…¥çš„æ˜¯ä¸€ä¸ªå•ç‹¬çš„ JavaScriptè„šæœ¬æ–‡ä»¶ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥è½½å…¥ä¸ä¸»çº¿ç¨‹åœ¨åŒä¸€ä¸ªç½‘é¡µçš„ä»£ç ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"worker"</span> <span class="attr">type</span>=<span class="string">"app/worker"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        postMessage(<span class="string">'some message'</span>);</span></span><br><span class="line"><span class="javascript">      &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([<span class="built_in">document</span>.querySelector(<span class="string">'#worker'</span>).textContent]);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">window</span>.URL.createObjectURL(blob);</span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(url);</span><br><span class="line"></span><br><span class="line">worker.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// e.data === 'some message'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="Worker-çº¿ç¨‹å®Œæˆè½®è¯¢"><a href="#Worker-çº¿ç¨‹å®Œæˆè½®è¯¢" class="headerlink" title="Worker çº¿ç¨‹å®Œæˆè½®è¯¢"></a>Worker çº¿ç¨‹å®Œæˆè½®è¯¢</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWorker</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([<span class="string">'('</span> + f.toString() + <span class="string">')()'</span>]);</span><br><span class="line">  <span class="keyword">var</span> url = <span class="built_in">window</span>.URL.createObjectURL(blob);</span><br><span class="line">  <span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(url);</span><br><span class="line">  <span class="keyword">return</span> worker;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pollingWorker = createWorker(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cache;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">compare</span>(<span class="params">new, old</span>) </span>&#123; ... &#125;;</span><br><span class="line"></span><br><span class="line">  setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    fetch(<span class="string">'/my-api-endpoint'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> data = res.json();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!compare(data, cache)) &#123;</span><br><span class="line">        cache = data;</span><br><span class="line">        self.postMessage(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">pollingWorker.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// render data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pollingWorker.postMessage(<span class="string">'init'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="Worker-å†…éƒ¨å†æ–°å»º-Worker"><a href="#Worker-å†…éƒ¨å†æ–°å»º-Worker" class="headerlink" title="Worker å†…éƒ¨å†æ–°å»º Worker"></a>Worker å†…éƒ¨å†æ–°å»º Worker</h4><h4 id="Worker-API"><a href="#Worker-API" class="headerlink" title="Worker API"></a>Worker API</h4><p>Worker çº¿ç¨‹çš„å…¨å±€å¯¹è±¡ä¸æ˜¯ windowï¼Œæ˜¯ WorkerGlobalScopeï¼Œå¯ä»¥é€šè¿‡ self ç›´æ¥è®¿é—®ã€‚self.nameã€self.onmessageã€self.onmessageerrorã€self.closeã€self.postMessageã€self.importScripts</p>

  </div>
  
</article>
    </main>
    <footer>
  <p>&copy; 2019 xcp0326</p>
</footer>
  </body>
</html>
