<!Doctype html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <title>æ‹–æ‹‰äº‹ä»¶ | FE ç¬”è®°æœ¬ ğŸš€</title>
  
    <link rel="icon" href="/images/favico.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/bjb/style/gitalk.css">
  <link rel="stylesheet" href="/bjb/style/style.css">
  <script src="/bjb/js/gitalk.min.js"></script>
</head>
  <body>
    <header class="header">
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/bjb/" class="menu-item-link">é¦–é¡µ</a>
        </li>
      
        <li class="menu-item">
          <a href="/bjb/archives" class="menu-item-link">å½’æ¡£</a>
        </li>
      
    </ul>
  </nav>
  <h1 class="pc">FE ç¬”è®°æœ¬ ğŸš€</h1>
  <h1 class="mobile"><a href="/">FE ç¬”è®°æœ¬ ğŸš€</a></h1>
  <em>ã€Œ å­¦æµ·æ— æ¶¯ï¼Œæ²¡ç©ºæ’©å¦¹ï¼ã€</em>
</header>
    <main class="main">
      <article class="post">
  <div class="post-title">
    <h2 class="title">æ‹–æ‹‰äº‹ä»¶</h2>
  </div>
  <div class="post-meta">
    <span class="post-time">2019-02-20 17:37:13</span>
    <span class="post-tags">
      
    </span>
    
  </div>
  <div class="post-content">
    <blockquote>
<p><sup>è¿™é‡Œæ˜¯æˆ‘è¯»<a href="https://wangdoc.com/javascript/" target="_blank" rel="noopener">ã€Šé˜®ä¸€å³° JavaScript æ•™ç¨‹ã€‹</a>åšçš„ç¬”è®°ã€‚</sup></p>
</blockquote>
<p>æ‹–æ‹‰æŒ‡çš„æ˜¯ï¼Œç”¨æˆ·åœ¨æŸä¸ªå¯¹è±¡ä¸ŠæŒ‰ä¸‹é¼ æ ‡ä¸æ”¾ï¼Œæ‹–åŠ¨å®ƒåˆ°å¦ä¸€ä¸ªä½ç½®ï¼Œç„¶åé‡Šæ”¾é¼ æ ‡é”®ï¼Œå°†è¯¥å¯¹è±¡æ”¾åœ¨é‚£é‡Œã€‚</p>
<p>æ‹–æ‹‰çš„å¯¹è±¡æœ‰å¥½å‡ ç§ï¼ŒåŒ…æ‹¬å…ƒç´ èŠ‚ç‚¹ã€å›¾ç‰‡ã€é“¾æ¥ã€é€‰ä¸­çš„æ–‡å­—ç­‰ã€‚åœ¨ç½‘é¡µä¸­ï¼Œé™¤äº†å…ƒç´ èŠ‚ç‚¹é»˜è®¤ä¸å¯ä»¥æ‹–æ‹‰ï¼Œå…¶ä»–ï¼ˆå›¾ç‰‡ã€é“¾æ¥ã€é€‰ä¸­çš„æ–‡å­—ï¼‰éƒ½æ˜¯å¯ä»¥ç›´æ¥æ‹–æ‹‰çš„ã€‚ä¸ºäº†è®©å…ƒç´ èŠ‚ç‚¹å¯æ‹–æ‹‰ï¼Œå¯ä»¥å°†è¯¥èŠ‚ç‚¹çš„ draggable è®¾ç½®ä¸º true</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">draggable</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  å¯æ‹–æ‹‰çš„ div</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸€æ—¦å…ƒç´ èŠ‚ç‚¹çš„ draggable å±æ€§è®¾ä¸º trueï¼Œå°±æ— æ³•å†ç”¨é¼ æ ‡é€‰ä¸­è¯¥èŠ‚ç‚¹å†…éƒ¨çš„æ–‡å­—æˆ–å­èŠ‚ç‚¹äº†ã€‚</p>
<p>å½“å…ƒç´ èŠ‚ç‚¹æˆ–é€‰ä¸­çš„æ–‡æœ¬è¢«æ‹–æ‹‰æ—¶ï¼Œå°±ä¼šæŒç»­è§¦å‘æ‹–æ‹‰äº‹ä»¶ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸€äº›äº‹ä»¶ã€‚</p>
<ul>
<li>dragï¼šæ‹–æ‹‰è¿‡ç¨‹ä¸­ï¼Œåœ¨è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹ä¸ŠæŒç»­è§¦å‘ï¼ˆç›¸éš”å‡ ç™¾æ¯«ç§’ï¼‰</li>
<li>dragstartï¼šç”¨æˆ·å¼€å§‹æ‹–æ‹‰æ—¶ï¼Œåœ¨è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹ä¸Šè§¦å‘ï¼Œè¯¥äº‹ä»¶çš„ target å±æ€§æ˜¯è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹ã€‚é€šå¸¸åº”è¯¥åœ¨è¿™ä¸ªäº‹ä»¶çš„ç›‘å¬å‡½æ•°ä¸­ï¼ŒæŒ‡å®šæ‹–æ‹‰çš„æ•°æ®ã€‚</li>
<li>dragendï¼šæ‹–æ‹‰ç»“æŸæ—¶ï¼ˆé‡Šæ”¾é¼ æ ‡é”®æˆ–æŒ‰ä¸‹ ESC é”®ï¼‰åœ¨è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹ä¸Šè§¦å‘ï¼Œè¯¥äº‹ä»¶çš„ target å±æ€§æ˜¯è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹ã€‚å®ƒä¸ dragstart äº‹ä»¶ï¼Œåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šè§¦å‘ã€‚ä¸ç®¡æ‹–æ‹‰æ˜¯å¦è·¨çª—å£ï¼Œæˆ–ä¸­é€”è¢«å–æ¶ˆï¼Œdragend äº‹ä»¶æ€»æ˜¯ä¼šè§¦å‘çš„ã€‚</li>
<li>dragenterï¼šæ‹–æ‹‰è¿›å…¥å½“å‰èŠ‚ç‚¹æ—¶ï¼Œåœ¨å½“å‰èŠ‚ç‚¹ä¸Šè§¦å‘ä¸€æ¬¡ï¼Œè¯¥äº‹ä»¶çš„ target å±æ€§æ˜¯å½“å‰èŠ‚ç‚¹ã€‚é€šå¸¸åº”è¯¥åœ¨è¿™ä¸ªäº‹ä»¶çš„ç›‘å¬å‡½æ•°ä¸­ï¼ŒæŒ‡å®šæ˜¯å¦å…è®¸åœ¨å½“å‰èŠ‚ç‚¹æ”¾ä¸‹ï¼ˆ drop ï¼‰æ‹–æ‹‰çš„æ•°æ®ã€‚å¦‚æœå½“å‰èŠ‚ç‚¹æ²¡æœ‰è¯¥äº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼Œæˆ–è€…ç›‘å¬å‡½æ•°ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå°±æ„å‘³ç€ä¸å…è®¸åœ¨å½“å‰èŠ‚ç‚¹æ”¾ä¸‹æ•°æ®ã€‚åœ¨è§†è§‰ä¸Šæ˜¾ç¤ºæ‹–æ‹‰è¿›å…¥å½“å‰èŠ‚ç‚¹ï¼Œä¹Ÿæ˜¯åœ¨è¿™ä¸ªäº‹ä»¶çš„ç›‘å¬å‡½æ•°ä¸­è®¾ç½®ã€‚</li>
<li>dragoverï¼šæ‹–æ‹‰åˆ°å½“å‰èŠ‚ç‚¹ä¸Šæ–¹æ—¶ï¼Œåœ¨å½“å‰èŠ‚ç‚¹ä¸ŠæŒç»­è§¦å‘ï¼ˆç›¸éš”å‡ ç™¾æ¯«ç§’ï¼‰ï¼Œè¯¥äº‹ä»¶çš„ target å±æ€§æ—¶å½“å‰èŠ‚ç‚¹ã€‚è¯¥äº‹ä»¶ä¸ dragenter äº‹ä»¶çš„åŒºåˆ«æ˜¯ï¼Œdragenter äº‹ä»¶åœ¨è¿›å…¥è¯¥èŠ‚ç‚¹æ—¶è§¦å‘ï¼Œç„¶ååªè¦æ²¡æœ‰ç¦»å¼€è¿™ä¸ªèŠ‚ç‚¹ï¼Œdragover äº‹ä»¶ä¼šæŒç»­è§¦å‘ã€‚</li>
<li>dragleaveï¼šæ‹–æ‹‰æ“ä½œç¦»å¼€å½“å‰èŠ‚ç‚¹èŒƒå›´æ—¶ï¼Œåœ¨å½“å‰èŠ‚ç‚¹ä¸Šè§¦å‘ï¼Œè¯¥äº‹ä»¶çš„ target å±æ€§æ˜¯å½“å‰èŠ‚ç‚¹ã€‚å¦‚æœè¦åœ¨è§†è§‰ä¸Šæ˜¾ç¤ºæ‹–æ‹‰ç¦»å¼€æ“ä½œå½“å‰èŠ‚ç‚¹ï¼Œå°±åœ¨è¿™ä¸ªäº‹ä»¶çš„ç›‘å¬å‡½æ•°ä¸­è®¾ç½®ã€‚</li>
<li>dropï¼šè¢«æ‹–æ‹‰çš„èŠ‚ç‚¹æˆ–é€‰ä¸­çš„æ–‡æœ¬ï¼Œé‡Šæ”¾åˆ°ç›®æ ‡èŠ‚ç‚¹æ—¶ï¼Œåœ¨ç›®æ ‡èŠ‚ç‚¹ä¸Šè§¦å‘ã€‚æ³¨æ„ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹ä¸å…è®¸ dropï¼Œè§£é‡Šåœ¨è¯¥èŠ‚ç‚¹ä¸Šæ”¾æ¾å¼€é¼ æ ‡é”®ï¼Œä¹Ÿä¸å›è§¦å‘è¯¥äº‹ä»¶ã€‚å¦‚æœç”¨æˆ·æŒ‰ä¸‹ ESCï¼Œå–æ¶ˆè¿™ä¸ªæ“ä½œï¼Œä¹Ÿä¸å›è§¦å‘è¯¥äº‹ä»¶ã€‚è¯¥äº‹ä»¶çš„ç›‘å¬å‡½æ•°è´Ÿè´£å»é™¤æ‹–æ‹‰æ•°æ®ï¼Œå¹¶è¿›è¡Œç›¸å…³å¤„ç†ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* HTML ä»£ç å¦‚ä¸‹</span></span><br><span class="line"><span class="comment"> &lt;div class="dropzone"&gt;</span></span><br><span class="line"><span class="comment">   &lt;div id="draggable" draggable="true"&gt;</span></span><br><span class="line"><span class="comment">     è¯¥èŠ‚ç‚¹å¯æ‹–æ‹‰</span></span><br><span class="line"><span class="comment">   &lt;/div&gt;</span></span><br><span class="line"><span class="comment"> &lt;/div&gt;</span></span><br><span class="line"><span class="comment"> &lt;div class="dropzone"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment"> &lt;div class="dropzone"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment"> &lt;div class="dropzone"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¢«æ‹–æ‹‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> dragged;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragstart'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä¿å­˜è¢«æ‹–æ‹‰èŠ‚ç‚¹</span></span><br><span class="line">  dragged = event.target;</span><br><span class="line">  <span class="comment">// è¢«æ‹–æ‹‰èŠ‚ç‚¹çš„èƒŒæ™¯è‰²å˜é€æ˜</span></span><br><span class="line">  event.target.style.opacity = <span class="number">0.5</span>;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragend'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¢«æ‹–æ‹‰èŠ‚ç‚¹çš„èƒŒæ™¯è‰²æ¢å¤æ­£å¸¸</span></span><br><span class="line">  event.target.style.opacity = <span class="string">''</span>;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragover'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// é˜²æ­¢æ‹–æ‹‰æ•ˆæœè¢«é‡ç½®ï¼Œå…è®¸è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹æ”¾å…¥ç›®æ ‡èŠ‚ç‚¹</span></span><br><span class="line">  event.preventDefault();</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragenter'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç›®æ ‡èŠ‚ç‚¹çš„èƒŒæ™¯è‰²å˜ç´«è‰²</span></span><br><span class="line">  <span class="comment">// ç”±äºè¯¥äº‹ä»¶ä¼šå†’æ³¡ï¼Œæ‰€ä»¥è¦è¿‡æ»¤èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (event.target.className === <span class="string">'dropzone'</span>) &#123;</span><br><span class="line">    event.target.style.background = <span class="string">'purple'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragleave'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç›®æ ‡èŠ‚ç‚¹çš„èƒŒæ™¯è‰²æ¢å¤åŸæ ·</span></span><br><span class="line">  <span class="keyword">if</span> (event.target.className === <span class="string">'dropzone'</span>) &#123;</span><br><span class="line">    event.target.style.background = <span class="string">''</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'drop'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</span><br><span class="line">  <span class="comment">// é˜²æ­¢äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼ˆæ¯”å¦‚æŸäº›å…ƒç´ èŠ‚ç‚¹ä¸Šå¯ä»¥æ‰“å¼€é“¾æ¥ï¼‰ï¼Œ</span></span><br><span class="line">  event.preventDefault();</span><br><span class="line">  <span class="keyword">if</span> (event.target.className === <span class="string">'dropzone'</span>) &#123;</span><br><span class="line">    <span class="comment">// æ¢å¤ç›®æ ‡èŠ‚ç‚¹èƒŒæ™¯è‰²</span></span><br><span class="line">    event.target.style.background = <span class="string">''</span>;</span><br><span class="line">    <span class="comment">// å°†è¢«æ‹–æ‹‰èŠ‚ç‚¹æ’å…¥ç›®æ ‡èŠ‚ç‚¹</span></span><br><span class="line">    dragged.parentNode.removeChild(dragged);</span><br><span class="line">    event.target.appendChild( dragged );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>æ–‡ä»¶ä»æ“ä½œç³»ç»Ÿæ‹–æ‹‰åˆ°æµè§ˆå™¨ï¼Œä¸ä¼šè§¦å‘ dragstart å’Œ dragend äº‹ä»¶</p>
</li>
<li><p>dragenter å’Œ dragover äº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼Œç”¨æ¥å–å‡ºæ‹–æ‹‰çš„æ•°æ®ï¼ˆå³å…è®¸æ”¾ä¸‹è¢«æ‹–æ‹‰çš„å…ƒç´ ï¼‰ã€‚ç”±äºç½‘é¡µçš„å¤§éƒ¨åˆ†åŒºåŸŸä¸é€‚åˆä½œä¸ºæ”¾ä¸‹æ‹–æ‹‰å…ƒç´ çš„ç›®æ ‡èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªäº‹ä»¶çš„é»˜è®¤è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹ä¸å…è®¸æ¥å—è¢«æ‹–æ‹‰çš„å…ƒç´ ã€‚å¦‚æœæƒ³è¦åœ¨ç›®æ ‡èŠ‚ç‚¹ä¸Šæ”¾ä¸‹çš„æ•°æ®ï¼Œé¦–å…ˆå¿…é¡»é˜»æ­¢è¿™ä¸¤ä¸ªäº‹ä»¶çš„é»˜è®¤è¡Œä¸ºã€‚</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ondragover</span>=<span class="string">"return false"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ondragover</span>=<span class="string">"evnet.preventDefault()"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸å–æ¶ˆæ‹–æ‹‰äº‹ä»¶æˆ–è€…é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œå°±ä¸èƒ½åœ¨ div èŠ‚ç‚¹ä¸Šæ”¾ä¸‹è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹ã€‚</p>
<h3 id="DragEvent-æ¥å£"><a href="#DragEvent-æ¥å£" class="headerlink" title="DragEvent æ¥å£"></a>DragEvent æ¥å£</h3><p>æ‹–æ‹‰äº‹ä»¶éƒ½ç»§æ‰¿äº† DragEvent æ¥å£ï¼Œè¿™ä¸ªæ¥å£åˆç»§æ‰¿äº† MouseEvent æ¥å£å’Œ Event æ¥å£ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> dragEvt = <span class="keyword">new</span> DragEvent(type, options)</span><br></pre></td></tr></table></figure>
<p>options é™¤äº†å¯ä»¥è®¾ç½® MouseEvent æ¥å£å’Œ Event æ¥å£çš„é…ç½®å±æ€§å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½® dataTransfer å±æ€§ï¼ŒdataTansfer è¦ä¹ˆæ˜¯ä¸€ä¸ª DataTransfer æ¥å£çš„å®ä¾‹ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª nullã€‚</p>
<p>DataTransfer çš„å®ä¾‹å¯¹è±¡ç”¨æ¥è¯»å†™æ‹–æ‹‰äº‹ä»¶ä¸­ä¼ è¾“çš„æ•°æ®</p>
<h3 id="DataTransfer-æ¥å£"><a href="#DataTransfer-æ¥å£" class="headerlink" title="DataTransfer æ¥å£"></a>DataTransfer æ¥å£</h3><p>æ‰€æœ‰æ‹–æ‹‰äº‹ä»¶çš„å®ä¾‹éƒ½æœ‰ä¸€ä¸ª DragEvent.dataTransfer å±æ€§ï¼Œç”¨æ¥è¯»å†™éœ€è¦ä¼ é€’çš„æ•°æ®ã€‚è¿™ä¸ªå±æ€§çš„å€¼æ˜¯ä¸€ä¸ª DataTransfer æ¥å£çš„å®ä¾‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> dataTrans = <span class="keyword">new</span> DataTransfer();</span><br></pre></td></tr></table></figure>
<p>DataTransfer() æ„é€ å‡½æ•°ä¸æ¥å—å‚æ•°</p>
<p>æ‹–æ‹‰çš„æ•°æ®åˆ†æˆä¸¤æ–¹é¢ï¼šæ•°æ®çš„ç§ç±»ï¼ˆåˆç§°æ ¼å¼ï¼‰å’Œæ•°æ®çš„å€¼ã€‚æ•°æ®çš„ç§ç±»æ˜¯ä¸€ä¸ª MIME å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚ text/plainã€image/jpegï¼‰ï¼Œæ•°æ®çš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæ‹–æ‹‰ä¸€æ®µæ–‡æœ¬ï¼Œåˆ™æ•°æ®é»˜è®¤å°±æ˜¯é‚£æ®µæ–‡æœ¬ï¼›å¦‚æœæ‹–æ‹‰ä¸€ä¸ªé“¾æ¥ï¼Œåˆ™æ•°æ®é»˜è®¤å°±æ˜¯é“¾æ¥çš„ URLã€‚</p>
<p>æ‹–æ‹‰äº‹ä»¶å¼€å§‹æ—¶ï¼Œå¼€å‘è€…å¯ä»¥æä¾›æ•°æ®ç±»å‹å’Œæ•°æ®å€¼ã€‚æ‹–æ‹‰è¿‡ç¨‹ä¸­ï¼Œå¼€å‘è€…é€šè¿‡ dragenter å’Œ dragover äº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼Œæ£€æŸ¥æ•°æ®ç±»å‹ï¼Œä»¥ç¡®å®šæ˜¯å¦å…è®¸æ”¾ä¸‹ï¼ˆdropï¼‰è¢«æ‹–æ‹‰çš„å¯¹è±¡ã€‚æ¯”å¦‚ï¼Œåœ¨åªå…è®¸æ”¾ä¸‹é“¾æ¥çš„åŒºåŸŸï¼Œæ£€æŸ¥æ‹–æ‹‰çš„æ•°æ®ç±»å‹æ˜¯å¦ä¸º text/uri-listã€‚</p>
<p>å‘ç”Ÿ drop äº‹ä»¶æ—¶ï¼Œç›‘å¬å‡½æ•°å–å‡ºæ‹–æ‹‰çš„æ•°æ®ï¼Œå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</p>
<h4 id="DataTransfer-dropEffect"><a href="#DataTransfer-dropEffect" class="headerlink" title="DataTransfer.dropEffect"></a>DataTransfer.dropEffect</h4><p>ç”¨æ¥è®¾ç½®æ”¾ä¸‹ï¼ˆdropï¼‰è¢«æ‹–æ‹‰èŠ‚ç‚¹æ—¶çš„æ•ˆæœï¼Œä¼šå½±å“åˆ°æ‹–æ‹‰ç»è¿‡ç›¸å…³åŒºåŸŸæ—¶é¼ æ ‡çš„å½¢çŠ¶ã€‚å®ƒå¯èƒ½å–ä¸‹é¢çš„å€¼ã€‚</p>
<ul>
<li>copyï¼šå¤åˆ¶è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹</li>
<li>moveï¼šç§»åŠ¨è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹</li>
<li>linkï¼šåˆ›å»ºæŒ‡å‘è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹çš„é“¾æ¥</li>
<li>noneï¼šæ— æ³•æ”¾ä¸‹è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">target.addEventListener(<span class="string">'dragover'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  e.stopPropagation();</span><br><span class="line">  e.dataTransfer.dropEffect = <span class="string">'copy'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¢«æ‹–æ‹‰å…ƒç´ ä¸€æ—¦è¢« dropï¼Œæ¥å—çš„åŒºåŸŸå°±ä¼šå¤åˆ¶è¯¥èŠ‚ç‚¹</p>
<p>dropEffect å±æ€§ä¸€èˆ¬åœ¨ dragenter å’Œ dragover äº‹ä»¶çš„ç›‘å¬å‡½æ•°ä¸­è®¾ç½®ï¼Œå¯¹äº dragstartã€dragã€dragleave è¿™ä¸‰ä¸ªäº‹ä»¶ä¸èµ·ä½œç”¨ã€‚å› ä¸ºè¯¥å±æ€§åªæ¥å—è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹çš„åŒºåŸŸæœ‰æ•ˆï¼Œå¯¹è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹æœ¬èº«æ— æ•ˆã€‚è¿›å…¥ç›®æ ‡åŒºåŸŸåï¼Œæ‹–æ‹‰è¡Œä¸ºä¼šåˆå§‹åŒ–æˆè®¾å®šçš„æ•ˆæœã€‚</p>
<h4 id="DataTransfer-effectAllowed"><a href="#DataTransfer-effectAllowed" class="headerlink" title="DataTransfer.effectAllowed"></a>DataTransfer.effectAllowed</h4><p>è®¾ç½®æœ¬æ¬¡æ‹–æ‹‰ä¸­å…è®¸çš„æ•ˆæœã€‚</p>
<ul>
<li>copyï¼šå¤åˆ¶è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹</li>
<li>moveï¼šç§»åŠ¨è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹</li>
<li>linkï¼šåˆ›å»ºæŒ‡å‘è¢«æ‹–æ‹‰èŠ‚ç‚¹çš„é“¾æ¥</li>
<li>copyLinkï¼šå…è®¸ copy æˆ– link</li>
<li>copyMoveï¼šå…è®¸ copy æˆ– move</li>
<li>linkMoveï¼šå…è®¸ link æˆ– move</li>
<li>allï¼šå…è®¸æ‰€æœ‰æ•ˆæœ</li>
<li>noneï¼šæ— æ³•æ”¾ä¸‹è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹</li>
<li>uninitializedï¼šé»˜è®¤å€¼ï¼Œç­‰åŒäº all</li>
</ul>
<p>å¦‚æœæŸç§æ•ˆæœæ˜¯ä¸å…è®¸çš„ï¼Œç”¨æˆ·å°±æ— æ³•åœ¨ç›®æ ‡èŠ‚ç‚¹ä¸­è¾¾æˆè¿™ç§æ•ˆæœã€‚</p>
<p>è¿™ä¸ªå±æ€§ä¸ dropEffect å±æ€§æ˜¯åŒä¸€ä»¶äº‹çš„ä¸¤ä¸ªæ–¹é¢ã€‚å‰è€…è®¾ç½®è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹å…è®¸çš„æ•ˆæœï¼Œåè€…è®¾ç½®æ¥å—æ‹–æ‹‰çš„åŒºåŸŸçš„æ•ˆæœï¼Œå®ƒä»¬å¾€å¾€é…åˆä½¿ç”¨ã€‚</p>
<p>dragstart äº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥è®¾ç½®è¿™ä¸ªå±æ€§ã€‚å…¶ä»–äº‹ä»¶çš„ç›‘å¬å‡½æ•°é‡Œé¢è®¾ç½®è¿™ä¸ªå±æ€§æ— æ•ˆã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">source.addEventListener(<span class="string">'dragstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  e.dataTransfer.effectAllowed = <span class="string">'move'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">target.addEventListener(<span class="string">'dragover'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  e.dataTransfer.dropEffect = <span class="string">'move'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>åªè¦ dropEffect å±æ€§å’Œ effectAllowed å±æ€§ä¹‹ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸º noneï¼Œå°±æ— æ³•åœ¨ç›®æ ‡èŠ‚ç‚¹ä¸Šå®Œæˆ drop æ“ä½œã€‚</p>
<h4 id="DataTransfer-files"><a href="#DataTransfer-files" class="headerlink" title="DataTransfer.files"></a>DataTransfer.files</h4><p>æ˜¯ä¸€ä¸ª FileList å¯¹è±¡ï¼ŒåŒ…å«ä¸€ç»„æœ¬åœ°æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥åœ¨æ‹–æ‹‰æ“ä½œä¸­ä¼ é€ã€‚å¦‚æœæœ¬æ¬¡æ‹–æ‹‰ä¸æ¶‰åŠæ–‡ä»¶ï¼Œåˆ™è¯¥å±æ€§ä¸ºç©ºçš„ FileList å¯¹è±¡ã€‚</p>
<p>ç”¨ FileReader å¯¹è±¡è¯»å–æ–‡ä»¶å†…å®¹</p>
<h4 id="DataTransfer-types"><a href="#DataTransfer-types" class="headerlink" title="DataTransfer.types"></a>DataTransfer.types</h4><p>åªè¯»æ•°ç»„ï¼Œæ¯ä¸ªæˆå‘˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‡Œé¢æ˜¯æ‹–æ‹‰çš„æ•°æ®æ ¼å¼ï¼ˆé€šå¸¸æ˜¯ MIME å€¼ï¼‰ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ‹–æ‹‰çš„æ˜¯æ–‡å­—ï¼Œå¯¹åº”çš„æˆå‘˜å°±æ˜¯ text/plainã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">contains</span>(<span class="params">list, value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.length; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (list[i] === value) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doDragOver</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åªæœ‰å½“è¢«æ‹–æ‹‰çš„èŠ‚ç‚¹æ˜¯ä¸€ä¸ªé“¾æ¥æ—¶ï¼Œæ‰å…è®¸åœ¨å½“å‰èŠ‚ç‚¹æ”¾ä¸‹</span></span><br><span class="line">  <span class="keyword">var</span> isLink = contains(event.dataTransfer.types, <span class="string">'text/uri-list'</span>);</span><br><span class="line">  <span class="keyword">if</span> (isLink) event.preentDefault();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="DataTransfer-items"><a href="#DataTransfer-items" class="headerlink" title="DataTransfer.items"></a>DataTransfer.items</h4><p>è¿”å›ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„åªè¯»å¯¹è±¡ DataTransferItemList å®ä¾‹ï¼Œæ¯ä¸ªæˆå‘˜å°±æ˜¯æœ¬æ¬¡æ‹–æ‹‰çš„ä¸€ä¸ªå¯¹è±¡ DataTransferItem å®ä¾‹ã€‚å¦‚æœæœ¬æ¬¡æ‹–æ‹‰ä¸åŒ…å«å¯¹è±¡ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ã€‚</p>
<p>DataTransferItemList å®ä¾‹å…·æœ‰ä»¥ä¸‹çš„å±æ€§å’Œæ–¹æ³•</p>
<ul>
<li>lengthï¼šè¿”å›æˆå‘˜çš„æ•°é‡</li>
<li>add(data, type)ï¼šå¢åŠ ä¸€ä¸ªæŒ‡å®šå†…å®¹å’Œç±»å‹ï¼ˆæ¯”å¦‚ text/html å’Œ text/plainï¼‰çš„å­—ç¬¦ä¸²ä½œä¸ºæˆå‘˜</li>
<li>add(file)ï¼šadd æ–¹æ³•çš„å¦ä¸€ç§ç”¨æ³•ï¼Œå¢åŠ ä¸€ä¸ªæ–‡ä»¶ä½œä¸ºæˆå‘˜</li>
<li>remove(index)ï¼šç§»é™¤æŒ‡å®šä½ç½®çš„æˆå‘˜</li>
<li>clear()ï¼šç§»é™¤æ‰€æœ‰çš„æˆå‘˜</li>
</ul>
<p>DataTransferItem å®ä¾‹å…·æœ‰ä»¥ä¸‹çš„å±æ€§å’Œæ–¹æ³•</p>
<ul>
<li>kindï¼šè¿”å›æˆå‘˜çš„ç§ç±»ï¼ˆstring è¿˜æ˜¯ fileï¼‰</li>
<li>typeï¼šè¿”å›æˆå‘˜çš„ç±»å‹ï¼ˆé€šå¸¸æ˜¯ MIME å€¼ï¼‰</li>
<li>getAsFile()ï¼šå¦‚æœè¢«æ‹–æ‹‰çš„æ–‡ä»¶ï¼Œè¿”å›è¯¥æ–‡ä»¶ï¼Œå¦åˆ™è¿”å› null</li>
<li>getAsString(callback)ï¼šå¦‚æœè¢«æ‹–æ‹‰çš„æ˜¯å­—ç¬¦ä¸²ï¼Œå°†è¯¥å­—ç¬¦ä¼ å…¥æŒ‡å®šçš„å›è°ƒå‡½æ•°å¤„ç†ã€‚è¯¥æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥éœ€è¦ä¼ å…¥å›è°ƒå‡½æ•°</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">div.addEventListener(<span class="string">'drop'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  <span class="keyword">if</span> (e.dataTransfer.items != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; e.dataTransfer.items.length; i++) &#123;</span><br><span class="line">			<span class="keyword">var</span> item = e.dataTransfer.items[i];</span><br><span class="line">      <span class="built_in">console</span>.log(item.kind + <span class="string">':'</span> + item.type)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="DataTransfer-setData"><a href="#DataTransfer-setData" class="headerlink" title="DataTransfer.setData()"></a>DataTransfer.setData()</h4><p>ç”¨æ¥è®¾ç½®æ‹–æ‹‰äº‹ä»¶æ‰€å¸¦æœ‰çš„æ•°æ®ã€‚è¯¥æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">event.dataTransfer.setData(<span class="string">'text/plain'</span>, <span class="string">'Text to drag'</span>);</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ QQ é‚®ç®± / çŸ¥ä¹é‡Œé¢çš„é“¾æ¥ æ‹–æ‹½åˆ°åœ°å€æ çš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡å®ƒæ¥ä¿®æ”¹çš„ URL</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">event.dataTransfer.setData(<span class="string">'text/uri-list'</span>, <span class="string">'http://www.zhihu.com/ex'</span>)</span><br></pre></td></tr></table></figure>
<p>åªæœ‰æŸä¸ªéƒ¨ç½²äº†ç‰¹å®šä»£ç çš„èŠ‚ç‚¹ï¼Œæ‰å¯èƒ½ dropï¼ˆè¯»å–åˆ°ï¼‰è¿™ä¸ªæ•°æ®</p>
<h4 id="DataTransfer-getData"><a href="#DataTransfer-getData" class="headerlink" title="DataTransfer.getData()"></a>DataTransfer.getData()</h4><p>é€šå¸¸åªæœ‰ drop äº‹ä»¶è§¦å‘åï¼Œæ‰èƒ½å–å‡ºæ•°æ®</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onDrop</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = e.dataTransfer.getData(<span class="string">'text/uri-list'</span>);</span><br><span class="line">  event.target.textContent = data;</span><br><span class="line">  event.preventDefault();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="DataTransfer-clearData"><a href="#DataTransfer-clearData" class="headerlink" title="DataTransfer.clearData()"></a>DataTransfer.clearData()</h4><p>åœ¨ dragstart äº‹ä»¶ç›‘å¬å‡½æ•°ä¸­æ¸…é™¤é™¤äº† Files ç±»å‹çš„æ•°æ®ã€‚ï¼ˆä¸èƒ½ç§»é™¤æ‹–æ‹‰çš„æ–‡ä»¶ï¼‰</p>
<h4 id="DataTransfer-setDragImage"><a href="#DataTransfer-setDragImage" class="headerlink" title="DataTransfer.setDragImage()"></a>DataTransfer.setDragImage()</h4><p>æ‹–åŠ¨è¿‡ç¨‹ä¸­ ï¼ˆåœ¨ dragstart äº‹ä»¶è§¦å‘åï¼‰ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºä¸€å¼ å›¾ç‰‡è·Ÿéšé¼ æ ‡ä¸€èµ·ç§»åŠ¨ï¼Œè¡¨ç¤ºè¢«æ¨åŠ¨çš„èŠ‚ç‚¹ã€‚è¿™ç§å›¾ç‰‡æ˜¯è‡ªåŠ¨åˆ›å»ºçš„ï¼Œé€šå¸¸æ˜¾ç¤ºä¸ºè¢«æ‹–åŠ¨èŠ‚ç‚¹çš„å¤–è§‚ã€‚</p>
<p>å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªæ˜¯ img èŠ‚ç‚¹æˆ–è€… canvas èŠ‚ç‚¹ï¼Œå¦‚æœçœç•¥æˆ–ä¸º nullï¼Œåˆ™ä½¿ç”¨è¢«æ‹–åŠ¨çš„èŠ‚ç‚¹çš„å¤–è§‚ï¼›ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºé¼ æ ‡ç›¸å¯¹äºè¯¥å›¾ç‰‡å·¦ä¸Šè§’çš„æ¨ªåæ ‡å’Œå³åæ ‡ã€‚<a href="http://js.jirengu.com/jozav" target="_blank" rel="noopener">ä¸€ä¸ª demo</a></p>

  </div>
  
</article>
    </main>
    <footer>
  <p>&copy; 2019 xcp0326</p>
</footer>
  </body>
</html>
