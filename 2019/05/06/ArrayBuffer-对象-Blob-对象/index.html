<!Doctype html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <title>ArrayBuffer å¯¹è±¡ä¸Blob å¯¹è±¡ | FE ç¬”è®°æœ¬ ğŸš€</title>
  
    <link rel="icon" href="/images/favico.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/bjb/style/gitalk.css">
  <link rel="stylesheet" href="/bjb/style/style.css">
  <script src="/bjb/js/gitalk.min.js"></script>
</head>
  <body>
    <header class="header">
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/bjb/" class="menu-item-link">é¦–é¡µ</a>
        </li>
      
        <li class="menu-item">
          <a href="/bjb/archives" class="menu-item-link">å½’æ¡£</a>
        </li>
      
    </ul>
  </nav>
  <h1 class="pc">FE ç¬”è®°æœ¬ ğŸš€</h1>
  <h1 class="mobile"><a href="/">FE ç¬”è®°æœ¬ ğŸš€</a></h1>
  <em>ã€Œ å­¦æµ·æ— æ¶¯ï¼Œæ²¡ç©ºæ’©å¦¹ï¼ã€</em>
</header>
    <main class="main">
      <article class="post">
  <div class="post-title">
    <h2 class="title">ArrayBuffer å¯¹è±¡ä¸Blob å¯¹è±¡</h2>
  </div>
  <div class="post-meta">
    <span class="post-time">2019-05-06 14:11:59</span>
    <span class="post-tags">
      
    </span>
    
  </div>
  <div class="post-content">
    <blockquote>
<p><sup>è¿™é‡Œæ˜¯æˆ‘è¯»<a href="https://wangdoc.com/javascript/" target="_blank" rel="noopener">ã€Šé˜®ä¸€å³° JavaScript æ•™ç¨‹ã€‹</a>åšçš„ç¬”è®°ã€‚</sup></p>
</blockquote>
<p>ArrayBuffer è¡¨ç¤ºä¸€æ®µäºŒè¿›åˆ¶æ•°æ®ï¼Œç”¨æ¥æ¨¡æ‹Ÿå†…å­˜é‡Œé¢çš„æ•°æ®ã€‚JavaScript é€šè¿‡å®ƒæ¥è¯»å†™äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> buffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">8</span>) <span class="comment">// 8 è¡¨ç¤º buffer å ç”¨ 8 ä¸ªå­—èŠ‚</span></span><br><span class="line">buffer.byteLength <span class="comment">// å¯ä»¥é€šè¿‡ byteLength è·å–å ç”¨çš„å†…å­˜å­—èŠ‚é•¿</span></span><br><span class="line">buffer.slice(<span class="number">0</span>) <span class="comment">// ç›¸å½“äºå¤åˆ¶ä¸€ä»½ buffer å†…å­˜</span></span><br></pre></td></tr></table></figure>
<p>Blob ï¼ˆBinary Large Objectï¼‰è¡¨ç¤ºäºŒè¿›åˆ¶æ–‡ä»¶çš„æ•°æ®å†…å®¹ã€‚ä¸ ArrayBuffer çš„åŒºåˆ«æ˜¯ï¼ŒBlob æ“ä½œäºŒè¿›åˆ¶æ–‡ä»¶çš„æ•°æ®å†…å®¹ï¼Œè€Œ ArrayBuffer ç”¨äºæ“ä½œå†…å­˜ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> b = <span class="keyword">new</span> Blob(array[, options])</span><br></pre></td></tr></table></figure>
<ul>
<li>arrayï¼šæˆå‘˜æ˜¯å­—ç¬¦ä¸²æˆ–è€…äºŒè¿›åˆ¶å¯¹è±¡è¡¨ç¤ºæ–°ç”Ÿæˆçš„ Blob å®ä¾‹å¯¹è±¡çš„å†…å®¹</li>
<li>optionsï¼šå¯é€‰é…ç½®å¯¹è±¡ï¼Œæœ‰ä¸€ä¸ª type å±æ€§è¡¨ç¤ºæ•°æ®çš„ MIME ç±»å‹</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> o = &#123;<span class="attr">a</span>: <span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">const</span> b = <span class="keyword">new</span> Blob([<span class="built_in">JSON</span>.stringify(o)], &#123;<span class="attr">type</span>: <span class="string">'applicaiton/json'</span>&#125;)</span><br><span class="line">b.size <span class="comment">// 7 ç­‰ä»·äº JSON.stringify(o).length</span></span><br><span class="line">b.type <span class="comment">// "application/json"</span></span><br><span class="line">b.slice(start, end, contentType) <span class="comment">// åˆ‡ç‰‡ b è¿”å›ä¸€ä¸ªæ–°çš„ Blob å®ä¾‹</span></span><br></pre></td></tr></table></figure>
<p>input file è¿”å› FileList å¯¹è±¡é‡Œçš„ File å®ä¾‹å¯¹è±¡æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Blob å®ä¾‹ï¼Œå®ƒé™¤äº†æœ‰ sizeï¼Œtype å±æ€§ï¼Œè¿˜æœ‰ name å’Œ lastModifiedDate å±æ€§ã€‚æ‹–æ”¾ API çš„ dataTransfer.files è¿”å›çš„ä¹Ÿæ˜¯ FileList å¯¹è±¡ï¼Œå®ƒçš„ File ä¹Ÿæ˜¯ Blob å®ä¾‹ã€‚</p>
<p>AJAX è¯·æ±‚æ—¶ï¼ŒresponseType æŒ‡å®šä¸º blobï¼Œé‚£ä¹ˆ get æ•°æ®æ—¶ï¼Œresponse è¿”å›çš„æ•°æ®ç±»å‹å°±æ—¶ blobã€‚</p>
<p>URL.createObjectURL() é’ˆå¯¹ Blob å¯¹è±¡ç”Ÿæˆä¸€ä¸ªä¸´æ—¶ URLï¼Œè¿™ä¸ª URL ä»¥ blob:// åè®®å¼€å¤´ï¼Œåè·Ÿä¸€ä¸ªè¯†åˆ«ç¬¦ï¼Œç”¨æ¥å”¯ä¸€å¯¹åº”å†…å­˜é‡Œé¢çš„ Blob å¯¹è±¡ã€‚ä¸ data:// URL  ( URL åŒ…å«å®é™…æ•°æ® ) å’Œ file:// URL ( æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿé‡Œé¢çš„æ–‡ä»¶ ) éƒ½ä¸ä¸€æ ·ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> droptarget = <span class="built_in">document</span>.getElementById(<span class="string">'droptarget'</span>);</span><br><span class="line"></span><br><span class="line">droptarget.ondrop = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> files = e.dataTransfer.files;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> type = files[i].type;</span><br><span class="line">    <span class="keyword">if</span> (type.substring(<span class="number">0</span>,<span class="number">6</span>) !== <span class="string">'image/'</span>)</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">    img.src = URL.createObjectURL(files[i]);</span><br><span class="line">    img.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.width = <span class="number">100</span>;</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>);</span><br><span class="line">      URL.revokeObjectURL(<span class="keyword">this</span>.src);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨å¤„ç† Blob URL è·Ÿæ™®é€š URL ä¸€æ ·ï¼Œå¦‚æœ Blob å¯¹è±¡ä¸å­˜åœ¨ï¼Œè¿”å› 404ï¼›å¦‚æœè·¨åŸŸè¯·æ±‚ï¼Œè¿”å› 403ã€‚Blob URL åªå¯¹ GET è¯·æ±‚æœ‰æ•ˆï¼Œå¦‚æœè¯·æ±‚æˆåŠŸï¼Œè¿”å› 200ã€‚ç”±äº Blob URL å°±æ˜¯æ™®é€š URLï¼Œå› æ­¤å¯ä»¥ä¸‹è½½ã€‚</p>
<p>è·å–åˆ° Blob å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ FileReader å¯¹è±¡è¯»å– Blob çš„å†…å®¹ã€‚</p>
<ul>
<li>FileReader.readAsText()</li>
<li>FileReader.readAsArrayBuffer()</li>
<li>FileReader.readAsDataURL()</li>
<li>FileReader.readAsBinaryString()</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// HTML ä»£ç å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">// &lt;input type="file" onchange="typefile(this.files[0])"&gt;&lt;/input&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">typefile</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ–‡ä»¶å¼€å¤´çš„å››ä¸ªå­—èŠ‚ï¼Œç”Ÿæˆä¸€ä¸ª Blob å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">var</span> slice = file.slice(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">  <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">  <span class="comment">// è¯»å–è¿™å››ä¸ªå­—èŠ‚</span></span><br><span class="line">  reader.readAsArrayBuffer(slice);</span><br><span class="line">  reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> buffer = reader.result;</span><br><span class="line">    <span class="comment">// å°†è¿™å››ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Œè§†ä½œä¸€ä¸ª32ä½æ•´æ•°</span></span><br><span class="line">    <span class="keyword">var</span> view = <span class="keyword">new</span> <span class="built_in">DataView</span>(buffer);</span><br><span class="line">    <span class="keyword">var</span> magic = view.getUint32(<span class="number">0</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// æ ¹æ®æ–‡ä»¶çš„å‰å››ä¸ªå­—èŠ‚ï¼Œåˆ¤æ–­å®ƒçš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">switch</span>(magic) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x89504E47</span>: file.verified_type = <span class="string">'image/png'</span>; <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x47494638</span>: file.verified_type = <span class="string">'image/gif'</span>; <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x25504446</span>: file.verified_type = <span class="string">'application/pdf'</span>; <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x504b0304</span>: file.verified_type = <span class="string">'application/zip'</span>; <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(file.name, file.verified_type);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  </div>
  
</article>
    </main>
    <footer>
  <p>&copy; 2019 xcp0326</p>
</footer>
  </body>
</html>
