<!Doctype html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <title>FE ç¬”è®°æœ¬ ğŸš€</title>
  
    <link rel="icon" href="/images/favico.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/bjb/style/gitalk.css">
  <link rel="stylesheet" href="/bjb/style/style.css">
  <script src="/bjb/js/gitalk.min.js"></script>
</head>
  <body>
    <header class="header">
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/bjb/" class="menu-item-link">é¦–é¡µ</a>
        </li>
      
        <li class="menu-item">
          <a href="/bjb/archives" class="menu-item-link">å½’æ¡£</a>
        </li>
      
    </ul>
  </nav>
  <h1 class="pc">FE ç¬”è®°æœ¬ ğŸš€</h1>
  <h1 class="mobile"><a href="/">FE ç¬”è®°æœ¬ ğŸš€</a></h1>
  <em>ã€Œ å­¦æµ·æ— æ¶¯ï¼Œæ²¡ç©ºæ’©å¦¹ï¼ã€</em>
</header>
    <main class="main">
      
  <article class="post">
  <div class="post-title">
    <h2 class="title">Mutation Observer API</h2>
  </div>
  <div class="post-meta">
    <span class="post-time">2018-12-28 14:16:46</span>
    <span class="post-tags">
      
    </span>
    
  </div>
  <div class="post-content">
    <blockquote>
<p><sup>è¿™é‡Œæ˜¯æˆ‘è¯»<a href="https://wangdoc.com/javascript/" target="_blank" rel="noopener">ã€Šé˜®ä¸€å³° JavaScript æ•™ç¨‹ã€‹</a>åšçš„ç¬”è®°ã€‚</sup></p>
</blockquote>
<p>Mutation Observer API ç”¨æ¥ç›‘è§† DOM å˜åŠ¨ã€‚DOM çš„ä»»ä½•å˜åŠ¨ï¼Œæ¯”å¦‚èŠ‚ç‚¹çš„å¢åˆ ã€å±æ€§çš„å˜åŠ¨ã€æ–‡æœ¬å†…å®¹çš„å˜åŠ¨ï¼Œè¿™ä¸ª API éƒ½å¯ä»¥å¾—åˆ°é€šçŸ¥ã€‚</p>
<p>æ¦‚å¿µä¸Šï¼Œå®ƒå¾ˆæ¥è¿‘äº‹ä»¶ï¼Œå¯ä»¥ç†è§£ä¸º DOM å‘ç”Ÿå˜åŠ¨å°±ä¼šè§¦å‘ Mutation Observer äº‹ä»¶ã€‚ä½†æ˜¯å®ƒä¸å®è·µæœ‰ä¸€ä¸ªæœ¬è´¨çš„ä¸åŒï¼Œäº‹ä»¶æ˜¯åŒæ­¥è§¦å‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒDOM çš„å˜åŠ¨ç«‹åˆ»ä¼šè§¦å‘ç›¸åº”çš„äº‹ä»¶ï¼›Moutation Observer åˆ™æ˜¯å¼‚æ­¥è§¦å‘ï¼ŒDOM çš„å˜åŠ¨å¹¶ä¸ä¼šé©¬ä¸Šè§¦å‘ï¼Œè€Œæ˜¯è¦ç­‰åˆ°å½“å‰æ‰€æœ‰ DOM æ“ä½œéƒ½ç»“æŸæ‰è§¦å‘ã€‚</p>
<p>è¿™æ ·è®¾è®¡æ˜¯ä¸ºäº†åº”å¯¹ DOM å˜åŠ¨é¢‘ç¹çš„ç‰¹ç‚¹ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœæ–‡æ¡£ä¸­è¿ç»­æ’å…¥ 1000 ä¸ª p æ ‡ç­¾ï¼Œå°±ä¼šè¿ç»­è§¦å‘ 1000 ä¸ªæ’å…¥äº‹ä»¶ï¼Œæ‰§è¡Œæ¯ä¸ªäº‹ä»¶çš„å›è°ƒå‡½æ•°ï¼Œè¿™å¾ˆå¯èƒ½é€ æˆæµè§ˆå™¨çš„å¡é¡¿ï¼›è€Œ Mutation Oberserver å®Œå…¨ä¸åŒï¼Œåªåœ¨ 1000 ä¸ªæ®µè½éƒ½æ’å…¥ç»“æŸåæ‰ä¼šè§¦å‘ï¼Œè€Œä¸”åªè§¦å‘ä¸€æ¬¡ã€‚</p>
<p>Mutation Observer æœ‰ä»¥ä¸‹ç‰¹ç‚¹</p>
<ul>
<li>å®ƒç­‰å¾…æ‰€æœ‰è„šæœ¬ä»»åŠ¡å®Œæˆåï¼Œæ‰ä¼šè¿è¡Œï¼ˆå³å¼‚æ­¥è§¦å‘æ–¹å¼ï¼‰</li>
<li>å®ƒæŠŠæ‰€æœ‰ DOM å˜åŠ¨è®°å½•å°è£…æˆä¸€ä¸ªæ•°ç»„è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¡æ¡ä¸ªåˆ«å¤„ç† DOM å˜åŠ¨</li>
<li>å®ƒæ—¢å¯ä»¥è§‚å¯Ÿ DOM çš„æ‰€æœ‰ç±»å‹å˜åŠ¨ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šåªè§‚å¯ŸæŸä¸€ç±»å˜åŠ¨</li>
</ul>
<h2 id="MutationObserver-æ„é€ å‡½æ•°"><a href="#MutationObserver-æ„é€ å‡½æ•°" class="headerlink" title="MutationObserver æ„é€ å‡½æ•°"></a>MutationObserver æ„é€ å‡½æ•°</h2><p>ä½¿ç”¨æ—¶ï¼Œé¦–å…ˆä½¿ç”¨ MutationObserver æ„é€ å‡½æ•°ï¼Œæ–°å»ºä¸€ä¸ªè§‚å¯Ÿå™¨å®ä¾‹ï¼ŒåŒæ—¶æŒ‡å®šè¿™ä¸ªå®ä¾‹çš„å›è°ƒå‡½æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> observer = <span class="keyword">new</span> MutationObserver(callback)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­çš„å›è°ƒå‡½æ•°ï¼Œä¼šåœ¨æ¯æ¬¡ DOM å˜åŠ¨åè°ƒç”¨ã€‚è¯¥å›è°ƒå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å˜åŠ¨æ•°ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯è§‚å¯Ÿå™¨å®ä¾‹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> observer = <span class="keyword">new</span> MutationObserver(<span class="function"><span class="keyword">function</span>(<span class="params">mutations, observer</span>) </span>&#123;</span><br><span class="line">  mutations.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">mutation</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(mutation)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="MutationObserver-çš„å®ä¾‹æ–¹æ³•"><a href="#MutationObserver-çš„å®ä¾‹æ–¹æ³•" class="headerlink" title="MutationObserver çš„å®ä¾‹æ–¹æ³•"></a>MutationObserver çš„å®ä¾‹æ–¹æ³•</h2><p>observer() ç”¨æ¥å¯åŠ¨ç›‘å¬ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ‰€è¦è§‚å¯Ÿçš„ DOM èŠ‚ç‚¹</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ï¼šä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒæŒ‡å®šæ‰€è¦è§‚å¯Ÿçš„ç‰¹å®šå˜åŠ¨</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> article = <span class="built_in">document</span>.querySelector(<span class="string">'article'</span>)</span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  <span class="string">'childList'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'attributes'</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">observer.observe(article, options)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œobserve æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ‰€è¦è§‚å¯Ÿçš„ DOM å…ƒç´ æ˜¯ articleï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰€è¦è§‚å¯Ÿçš„å˜åŠ¨ç±»å‹ï¼ˆå­èŠ‚ç‚¹å˜åŠ¨å’Œå±æ€§å˜åŠ¨ï¼‰ã€‚</p>
<p>è§‚å¯Ÿå™¨æ‰€èƒ½è§‚å¯Ÿçš„ DOM å˜åŠ¨ç±»å‹ï¼ˆå³ä¸Šé¢ä»£ç çš„ options å¯¹è±¡ï¼‰ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ã€‚</p>
<ul>
<li>childListï¼šå­èŠ‚ç‚¹çš„å˜åŠ¨ï¼ˆæŒ‡æ–°å¢ï¼Œåˆ é™¤æˆ–è€…æ›´æ”¹ï¼‰</li>
<li>attributesï¼šå±æ€§çš„å˜åŠ¨</li>
<li>characterDataï¼šèŠ‚ç‚¹å†…å®¹æˆ–è€…èŠ‚ç‚¹æ–‡æœ¬çš„å˜åŠ¨</li>
</ul>
<p>æƒ³è¦è§‚å¯Ÿå“ªä¸€ç§å˜åŠ¨ç±»å‹ï¼Œå°±åœ¨ option å¯¹è±¡ä¸­æŒ‡å®šå®ƒçš„å€¼ä¸º trueã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»åŒæ—¶æŒ‡å®š childListã€attributes å’Œ characterData ä¸­çš„ä¸€ç§æˆ–å¤šç§ï¼Œè‹¥æœªå‡æŒ‡å®šå°†æŠ¥é”™ã€‚</p>
<p>é™¤äº†å˜åŠ¨ç±»å‹ï¼Œoptions å¯¹è±¡è¿˜å¯ä»¥è®¾å®šä»¥ä¸‹å±æ€§ï¼š</p>
<ul>
<li>subtreeï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å°†è¯¥è§‚å¯Ÿå™¨åº”ç”¨ä¸è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰åä»£èŠ‚ç‚¹</li>
<li>attributeOldValueï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè§‚å¯Ÿ attributes å˜åŠ¨æ—¶ï¼Œæ˜¯å¦éœ€è¦è®°å½•å˜åŠ¨å‰çš„å±æ€§å€¼ã€‚</li>
<li>characterDataOldValueï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè§‚å¯Ÿ characterData å˜åŠ¨çš„å€¼</li>
<li>attributeFilterï¼šæ•°ç»„ï¼Œè¡¨ç¤ºéœ€è¦è§‚å¯Ÿçš„ç‰¹å®šå±æ€§ï¼ˆæ¯”å¦‚[â€˜classâ€™,â€™srcâ€™]ï¼‰</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mutationObserver.observe(<span class="built_in">document</span>.documentElement, &#123;</span><br><span class="line">  attributes: <span class="literal">true</span>,</span><br><span class="line">  characterData: <span class="literal">true</span>,</span><br><span class="line">  childList: <span class="literal">true</span>,</span><br><span class="line">  subtree: <span class="literal">true</span>,</span><br><span class="line">  attributeOldValue: <span class="literal">true</span>,</span><br><span class="line">  characterDataOldValue: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¯¹ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ è§‚å¯Ÿå™¨ï¼Œå°±åƒä½¿ç”¨ addEventListener æ–¹æ³•ä¸€æ ·ï¼Œå¤šæ¬¡æ·»åŠ åŒä¸€ä¸ªè§‚å¯Ÿå™¨æ—¶æ— æ•ˆçš„ï¼Œå›è°ƒå‡½æ•°ä¾ç„¶åªä¼šè§¦å‘ä¸€æ¬¡ã€‚ä½†æ˜¯å¦‚æœæŒ‡å®šä¸åŒçš„ options å¯¹åƒï¼Œå°±ä¼šè¢«å½“ä½œä¸¤ä¸ªä¸åŒçš„è§‚å¯Ÿå™¨ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­æ˜¯è§‚å¯Ÿæ–°å¢çš„å­èŠ‚ç‚¹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> insertedNodes = []</span><br><span class="line"><span class="keyword">var</span> observer = <span class="keyword">new</span> MutationObserver(<span class="function"><span class="keyword">function</span>(<span class="params">mutations</span>) </span>&#123;</span><br><span class="line">  mutations.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">mutation</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; mutation.addedNodes.length; i++) &#123;</span><br><span class="line">      insertedNodes.push(mutation.addedNoeds[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">observer.observe(<span class="built_in">document</span>, &#123;<span class="attr">childList</span>: <span class="literal">true</span>&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(insertedNodes)</span><br></pre></td></tr></table></figure>
<h3 id="disconnect-ï¼ŒtakeRecords"><a href="#disconnect-ï¼ŒtakeRecords" class="headerlink" title="disconnect()ï¼ŒtakeRecords()"></a>disconnect()ï¼ŒtakeRecords()</h3><p>disconnect æ–¹æ³•ç”¨æ¥åœæ­¢è§‚å¯Ÿã€‚è°ƒç”¨è¯¥æ–¹æ³•åï¼ŒDOM å†å‘ç”Ÿå˜åŠ¨ï¼Œä¹Ÿä¸å›è§¦å‘è§‚å¯Ÿå™¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">observer.disconnect()</span><br></pre></td></tr></table></figure>
<p>takeRecords æ–¹æ³•ç”¨æ¥æ¸…é™¤å˜åŠ¨è®°å½•ï¼Œå³ä¸å†å¤„ç†æœªå¤„ç†çš„å˜åŠ¨ã€‚è¯¥æ–¹æ³•è¿”å›å˜åŠ¨è®°å½•çš„æ•°ç»„ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">observer.takeRecords()</span><br></pre></td></tr></table></figure>
<h2 id="MutationRecord-å¯¹è±¡"><a href="#MutationRecord-å¯¹è±¡" class="headerlink" title="MutationRecord å¯¹è±¡"></a>MutationRecord å¯¹è±¡</h2><p>DOM æ¯æ¬¡å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šç”Ÿæˆä¸€æ¡å˜åŠ¨è®°å½•ï¼ˆMutationRecord å®ä¾‹ï¼‰ã€‚è¯¥å®ä¾‹åŒ…å«äº†ä¸å˜åŠ¨ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯ã€‚Mutation Observer å¤„ç†çš„å°±æ˜¯ä¸€ä¸ªä¸ª MutationRecord å®ä¾‹æ‰€ç»„æˆçš„æ•°ç»„ã€‚</p>
<p>MutationRecord å¯¹è±¡åŒ…å«äº† DOM ç›¸å…³ä¿¡æ¯ï¼Œæœ‰å¦‚ä¸‹å±æ€§ï¼š</p>
<ul>
<li>typeï¼šè§‚å¯Ÿçš„å˜åŠ¨ç±»å‹ï¼ˆattributesã€characterData æˆ–è€… childListï¼‰</li>
<li>targetï¼šå‘ç”Ÿå˜åŠ¨çš„ DOM èŠ‚ç‚¹</li>
<li>addedNodesï¼šæ–°å¢çš„ DOM èŠ‚ç‚¹</li>
<li>removedNodesï¼šåˆ é™¤çš„ DOM èŠ‚ç‚¹</li>
<li>previousSiblingï¼šå‰ä¸€ä¸ªåŒçº§èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å› null</li>
<li>nextSiblingï¼šä¸‹ä¸€ä¸ªåŒçº§èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å› null</li>
<li>attributeNameï¼šå‘ç”Ÿå˜åŠ¨çš„å±æ€§ã€‚å¦‚æœè®¾ç½®äº† attributeFilterï¼Œåˆ™åªè¿”å›é¢„å…ˆæŒ‡å®šçš„å±æ€§ã€‚</li>
<li>oldValueï¼šå˜åŠ¨å‰çš„å€¼ã€‚è¿™ä¸ªå±æ€§åªå¯¹ attribute å’Œ characterData å˜åŠ¨æœ‰æ•ˆï¼Œå¦‚æœå‘ç”Ÿ childList å˜åŠ¨ï¼Œåˆ™è¿”å› null</li>
</ul>
<h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>å­å…ƒç´ çš„å˜åŠ¨</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> callback = <span class="function"><span class="keyword">function</span>(<span class="params">records</span>) </span>&#123;</span><br><span class="line">  records.map(<span class="function"><span class="keyword">function</span>(<span class="params">record</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Mutation type:'</span> + record.type)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Mutation target:'</span> + record.target)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mo = <span class="keyword">new</span> MutationObserver(callback)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  <span class="string">'childList'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'subtree'</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mo.observe(<span class="built_in">document</span>.body, option)</span><br></pre></td></tr></table></figure>
<p>å±æ€§çš„å˜åŠ¨</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> callback = <span class="function"><span class="keyword">function</span>(<span class="params">records</span>) </span>&#123;</span><br><span class="line">  records.map(<span class="function"><span class="keyword">function</span>(<span class="params">record</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Prevous attributes value:'</span> + record.oldValue)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mo = <span class="keyword">new</span> MutationObserver(callback)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> element = docuemnt.getElementById(<span class="string">'my_element'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  <span class="string">'attributes'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'attributeOldValue'</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mo.observe(element, options)</span><br></pre></td></tr></table></figure>
<p>å–ä»£ DOMContentLoaded äº‹ä»¶</p>
<p>ç½‘é¡µåŠ è½½çš„æ—¶å€™ï¼ŒDOM èŠ‚ç‚¹çš„ç”Ÿæˆä¼šäº§ç”Ÿå˜åŠ¨è®°å½•ï¼Œå› æ­¤åªè¦è§‚å¯Ÿ DOM çš„å˜åŠ¨ï¼Œå°±èƒ½åœ¨ç¬¬ä¸€æ—¶é—´è§¦å‘ç›¸å…³äº‹ä»¶ï¼Œå› æ­¤ä¹Ÿå°±ä¹ˆæœ‰å¿…è¦ä½¿ç”¨ DOMContentLoaded äº‹ä»¶ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> observer = <span class="keyword">new</span> Mutation Observer(callback)</span><br><span class="line">observer.observe(<span class="built_in">document</span>.documentElement, &#123;</span><br><span class="line">  childList: <span class="literal">true</span>,</span><br><span class="line">  subtree: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ç›‘å¬ document.documentElement ï¼ˆå³ HTML èŠ‚ç‚¹ï¼‰çš„å­èŠ‚ç‚¹çš„å˜åŠ¨ï¼Œsubtree å±æ€§æŒ‡å®šç›‘å¬è¿˜åŒ…æ‹¬åä»£èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œä»»æ„ä¸€ä¸ªç½‘é¡µå…ƒç´ ä¸€æ—¦ç”Ÿæˆï¼Œå°±èƒ½ç«‹åˆ»è¢«ç›‘å¬åˆ°ã€‚</p>
<p>ä¸‹é¢çš„ä»£ç ï¼Œä½¿ç”¨ MutationObserver å¯¹è±¡å°è£…ä¸€ä¸ªç›‘å¬ DOM ç”Ÿæˆçš„å‡½æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">win</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> listeners = []</span><br><span class="line">  <span class="keyword">var</span> doc = win.document</span><br><span class="line">  <span class="keyword">var</span> MutationObserver = win.MutationObserver || win.WebKitMutationObserver</span><br><span class="line">  <span class="keyword">var</span> observer</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ready</span>(<span class="params">selector, fn</span>) </span>&#123;</span><br><span class="line">    listeners.push(&#123;</span><br><span class="line">      selector: selector,</span><br><span class="line">      fn: fn</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (!observer) &#123;</span><br><span class="line">      observer = <span class="keyword">new</span> MutationObserver(check)</span><br><span class="line">      observer.observe(doc.documentElement, &#123;</span><br><span class="line">        childList: <span class="literal">true</span>,</span><br><span class="line">        subtree: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    check()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> listener = listeners[i]</span><br><span class="line">      <span class="keyword">var</span> elements = doc.querySelectorAll(listener.selector)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; elements.length; j++) &#123;</span><br><span class="line">        <span class="keyword">var</span> element = elements[j]</span><br><span class="line">        <span class="keyword">if</span> (!element.ready) &#123;</span><br><span class="line">          element.ready = <span class="literal">true</span></span><br><span class="line">          listener.fn.call(element, element)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  win.ready = ready</span><br><span class="line">  </span><br><span class="line">&#125;)(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">ready(<span class="string">'.foo'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

  </div>
  
</article>


  <nav class="page-nav">
    <a class="extend prev" rel="prev" href="/bjb/page/27/">&laquo;ä¸Šä¸€é¡µ</a><a class="page-number" href="/bjb/">1</a><span class="space">&hellip;</span><a class="page-number" href="/bjb/page/26/">26</a><a class="page-number" href="/bjb/page/27/">27</a><span class="page-number current">28</span><a class="page-number" href="/bjb/page/29/">29</a><a class="page-number" href="/bjb/page/30/">30</a><span class="space">&hellip;</span><a class="page-number" href="/bjb/page/66/">66</a><a class="extend next" rel="next" href="/bjb/page/29/">ä¸‹ä¸€é¡µ&raquo;</a>
  </nav>

    </main>
    <footer>
  <p>&copy; 2019 xcp0326</p>
</footer>
  </body>
</html>
