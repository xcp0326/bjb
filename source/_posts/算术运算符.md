---
title: 算术运算符
category:
date: 2018-11-21 22:51:37
---

> <sup>这里是我读[《阮一峰 JavaScript 教程》](https://wangdoc.com/javascript/)做的笔记。</sup>

JavaScript 提供了 10 个算术运算符，用来完成基本的算术元素。

1. 加法运算符 `x + y`
2. 减法运算符 `x - y`
3. 乘法运算符 `x * y`
4. 除法运算符 `x / y`
5. 指数运算符 `x ** y`
6. 余数运算符 `x % y`
7. 自增运算符 `++x` 或者 `x++`
8. 自减运算符 `--x` 或者 `x--`
9. 数值运算符 `+x`
10. 负数值运算符 `-x`

## 加法运算符

JavaScript 允许非数值的相加。

### 基本规则

加法运算符是在运算时决定到底是执行相加还是执行连接。也就是说运算子的不同，导致了不同的语法行为，这种现象称为“重载”（overload）。



- 数值相加 ：直接相加

  ```js
  1 + 1 // 2
  ```

- 布尔值相加 ：转换为对应的布尔值数值然后相加

  - 两个布尔值相加

    ```js
    true + true // 2
    ```

  - 一个布尔值加一个数值

    ```js
    true + 1 // 2
    1 + false // 1
    ```

- 字符串相加

  - 两个字符串相加 ：字符串相连

    ```js
    '1' + '1' // '11'
    ```

  - 一个字符串和非字符串 ：非字符串转为字符串然后相连

    ```js
    '1' + true // '1true'
    true + '1' // 'true1'
    ```

  - 一个字符串加多个数字 ：数值会被转为字符串然后相连

    ```js
    '1' + 1 + 1 // '111'
    ```

  - 多个数字加一个字符串 ：数值相加然后连接字符串

    ```js
    1 + 1 + '1' // '21'
    ```

### 对象相加

如果运算子是对象，必须先转称原始类型的值，然后在相加。

对象转成原始类型的步骤：

1. 调用 valueOf 方法
2. 如果第 1 步的值不是原始类型，就再调用 toString 方法

```js
var obj = {p: 1}
obj.valueOf().toString() // "[object Obect]"

obj + 1 // "[object Object]1"
```

按照这个规则，我们可以自定义 valueOf 和 toString 方法来得到想要的结果。

```js
var obj = {
  valueOf: function() {
    return 1
  }
}
obj + 2 // 3
```

按照对象转原始类型的规则，上面 `obj.valueOf()` 返回原始类型 1，所以就是 `1 + 2` 的返回值就是 3

```js
var obj = {
  toString: function() {
    return 'hello'
  }
}
obj + 2 // 'hello2'
```

按照对象转原始类型的规则，上面 `obj.valueOf()` 是 `{p: 1}`，所以就执行 toString 方法，调用了我们自定义的 toString 方法，返回 hello，最后的值为 hello2

有一个特例，如果运算子是 Date 对象的实例，那么会优先执行 toString 方法。

```js
var obj = new Date()
obj.valueOf = function() {return 1}
obj.toString = function() {return 'hello'}
obj + 2 // 'hello2'
```

## 余数运算符

余数运算符 `%` 返回前一个运算子被后一个运算子除，所得的余数。

```js
12 % 5 // 2
```

运算的结果的正负由第一个运算子的正负号决定。真是诡异 😨

```js
-1 % 2 // -1
1 % -2 // 1
```

所以为了的到负数的正确余数值，可以先使用绝对值函数。

```js
function isOdd(n) {
  return Math.abs(n % 2) === 1
}
isOdd(-5) // true
isOdd(-4) // false
```

余数可以用于浮点数的运算，只是浮点数不是精确数值，不能得到准确的数值。可以先移动小数点的位置到最后，等计算完再将小数点的位置挪回来。

## 自增和自减运算符

自增和自减运算符，是一元运算符，只需要一个运算子。他们的作用是将运算子首先转为数值，然后再加上 1 或者减去 1。会修改原始变量。

```js
var x = 1
++x // 2
x // 2

--x // 1
x // 1
```

运算之后，变量的值发生变化，这种效应叫做副作用（side effect）。自增和自减运算符是仅有的两个具有副作用的运算符，其他运算符都不会改变变量的值。

自增和自减运算符有一个需要注意的地方，就是放在变量之后，会先返回变量操作前的值，再进行自增/自减操作；放在变量之前，会先进行自增/自减操作，再返回变量操作后的值。

```js
var x = 1
var y = 1
x++ // 1
++y // 2
```

## 数值运算符、负数值运算符

数值运算符同样适用加号，但他是一元运算符（只需要一个操作数），而加法运算符是二元运算符（需要两个操作数）。

数值运算符的作用是可以将任何值转为数值（与 Number 函数的作用相同）

```js
+true // 1
+[] // 0
+{} // NaN
```

负数值运算符是减号，也同样具有将一个值转为数值的功能，只不过得到的值正负相反。连用两个负数值运算符，等同于数值运算符。

```js
-'1' // -1
-true // -1
-[] // -0
-{} // NaN
```

## 指数运算符

指数运算符 `**` 完成指数运算，前一个运算子是底数，后一个运算子是指数

```js
2 ** 3 // 8
```

指数运算符是右结合，而不是左结合。即多个指数运算符连用时，先进行最右边的计算。

```js
2 ** 3 ** 2 // 相当于 2 ** (3 ** 2) 结果为 512
```

## 赋值运算符

复合的赋值运算符，都是先进行指定的运算，然后再将得到的值赋给左边的变量。

```js
var x = 1
x += 2 // x = x + 2 所以结果是 3
```

