<!Doctype html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <title>FE NOTEBOOK 🚀</title>
  
    <link rel="icon" href="/images/favico.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/style/gitalk.css">
  <link rel="stylesheet" href="/style/style.css">
  <script src="/js/gitalk.min.js"></script>
</head>
  <body>
    <header class="header">
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">首页</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link">归档</a>
        </li>
      
    </ul>
  </nav>
  <h1 class="pc">FE NOTEBOOK 🚀</h1>
  <h1 class="mobile"><a href="/">FE NOTEBOOK 🚀</a></h1>
  <em>「 学海无涯，没空撩妹！」</em>
</header>
    <main class="main">
      
  <article class="post">
  <div class="post-title">
    <h2 class="title">数组 API 之 forEach、reduce</h2>
  </div>
  <div class="post-meta">
    <span class="post-time">2018-12-18 23:31:15</span>
    <span class="post-tags">
      
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/forEach/">forEach</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/reduce/">reduce</a></li></ul>
      
    </span>
    
      <div class="article-category">分类：
        <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
      </div>
    
  </div>
  <div class="post-content">
    <h2 id="forEach-的实现"><a href="#forEach-的实现" class="headerlink" title="forEach 的实现"></a>forEach 的实现</h2><p>一个数组 arr 调用 forEach 方法，并传入 callback 方法：<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">arr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value, index</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value, index)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 1 0</span></span><br><span class="line"><span class="comment">// 2 1</span></span><br><span class="line"><span class="comment">// 3 2</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到 callback 里面并没有传入 arr，那 callback 是怎么获取到数组 arr 的 value 和 index 的了。</p>
<p>它是通过 this 关键字来传入的。JavaScript 已经帮我们把 arr 传入了，类似调用了函数的 call 方法，并把 call 方法的第一个参数 this 指向 arr。如下：<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">arr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">arr.forEach.call(arr, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)</span><br></pre></td></tr></table></figure></p>
<p>我们的 forEach 的实现<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 我们的 forEach 实现</span></span><br><span class="line">obj.forEach = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; obj.length; i++) &#123;</span><br><span class="line">    x(obj[i], i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 有个 obj</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="number">2</span>,</span><br><span class="line">  length: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用 forEach 方法：</span></span><br><span class="line">obj.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value, key</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value, key)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 1 0</span></span><br><span class="line"><span class="comment">// 2 1</span></span><br></pre></td></tr></table></figure></p>
<p>所以从数据结构来看，数组和对象其实没有差别。</p>
<h2 id="arr-sort"><a href="#arr-sort" class="headerlink" title="arr.sort"></a>arr.sort</h2><p>arr.sort 原地排序自身，可以省空间。数组的其他 API 都不会修改原数组。</p>
<p>数组的 API 返回一个数组，所以可以操作成链式操作。</p>
<h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><p>举个列子，范伟火车上打劫 “IC、IP、IQ 卡通通告诉我密码。” 😂，火车上有 10 个人。</p>
<table>
<thead>
<tr>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody>
<tr>
<td>100</td>
<td>200</td>
<td>30</td>
<td>10</td>
<td>20</td>
<td>200</td>
<td>100</td>
<td>30</td>
<td>10</td>
<td>30</td>
</tr>
</tbody>
</table>
<p>范伟手里最开始是么有钱的，钱数为 0，即初始值为 0<br>当打劫完第 1 个人，钱数变为了 0 + 100 = 100<br>打劫完第 2 个人，钱数变成了 100 + 200 = 300<br>打劫完第 3 个人，钱数就变成了 300 + 30 = 330<br>…<br>就是也就是累加。把之前打劫的钱加上新的打劫的钱。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">100</span>, <span class="number">200</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">30</span>]</span><br><span class="line">arr.reduce(<span class="function">(<span class="params">preValue, currentValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> preValue + currentValue</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="comment">// 730</span></span><br></pre></td></tr></table></figure>
<p>map 和 filter 都可以用 reduce 表示。</p>
<h3 id="map-用-reduce-表示"><a href="#map-用-reduce-表示" class="headerlink" title="map 用 reduce 表示"></a>map 用 reduce 表示</h3><p>数组所有值乘以 2</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">100</span>, <span class="number">200</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">30</span>]</span><br><span class="line">arr.reduce(<span class="function">(<span class="params">prevValue, currentValue</span>) =&gt;</span> &#123;</span><br><span class="line">  prevValue.push(currentValue * <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">return</span> prevValue</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure>
<h3 id="filter-用-reduce-表示"><a href="#filter-用-reduce-表示" class="headerlink" title="filter 用 reduce 表示"></a>filter 用 reduce 表示</h3><p>比如过滤大于 100 的数值</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">100</span>, <span class="number">200</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">30</span>]</span><br><span class="line">arr.reduce(<span class="function">(<span class="params">prevValue, currentValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (currentValue &gt; <span class="number">100</span>) &#123;</span><br><span class="line">    prevValue.push(currentValue)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> prevValue</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure>
<p>所以说，map 和 filter 其实这是 reduce 的一个实现。</p>

  </div>
  
</article>


  <nav class="page-nav">
    <a class="extend prev" rel="prev" href="/page/48/">&laquo;上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/47/">47</a><a class="page-number" href="/page/48/">48</a><span class="page-number current">49</span><a class="page-number" href="/page/50/">50</a><a class="page-number" href="/page/51/">51</a><span class="space">&hellip;</span><a class="page-number" href="/page/112/">112</a><a class="extend next" rel="next" href="/page/50/">下一页&raquo;</a>
  </nav>

    </main>
    <footer>
  <p>&copy; 2019 code.dsphoebe.com <wbr> <a href="http://www.miitbeian.gov.cn/">京ICP备15048606号-1</a></p>
</footer>
  </body>
</html>
